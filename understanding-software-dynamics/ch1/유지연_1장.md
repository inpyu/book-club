# 1장 너무 느린 내 프로그램

### 1.1 데이터 센터의 측면

서버 : 트랜잭션 처리하는 컴퓨터

트랜잭션 : 한꺼번에 수행되어야 할 연산, DB의 상태를 변경시키는 작업의 단위

처리 부하 : 초 당 처리할 수 있는 트랜잭션 수 

서비스 : 트랜잭션 처리하는 프로그램 모음

꼬리 지연 시간 : 분포 중에서 가장 느린 트랜잭션

역동성 : 시간에 따른 활동

> 예시가 어떤게 있을까? 

> 서비스 메시 환경에서 conntrack 테이블 수가 많아서 호출 도메인 쿼리 수 줄이려고 했달까,,

>> 일반적인 도메인 / FQDN(Full Qualified Domain Name) DNS 조회 시 이를 통해 호스트 이름의 끝임을 명시적으로 지정 쿼리 수 줄임

배치 소프트웨어, 오프라인 소프트웨어(인터넷 없이도 사용가능한 소프트웨어)는 일반적인 소프트웨어어랑은 차이가 있음 : 응답시간 보다는 효율적인 하드웨어 사용률 우선
>  데이터 센터에서는 하드웨어 자원을 효율적으로 사용하는 것이 중요하다. 여러 사용자나 서비스가 동일한 하드웨어 자원을 공유하기 때문

>  실제로 배치 성에는 livenessprobe, readinessprobe 뺐음

### 1.2 데이터 센터 하드웨어

각 서버는 여러 프로그램을 실행하고, 각 프로그램은 여러 스레드로 동작

여유 서버 필요 ,, 공감합니다


### 1.3 데이터 센터 소프트웨어

동시에 병렬적으로 동작하는 여러 서비스가 계층을 이뤄 각자 개별적인 요청을 처리하고, 하나의 서비스가 여러 인스턴스로 동작해서 각 서비스가 각기 다른 지연 시간 목표

hit : 캐싱된 데이터를 찾아 재사용
miss : 찾지 못 함

-> 캐시의 역동성은 예상하지 못하게 트랜잭션 지연시간에 영향을 준다
> 소프트웨어 네트워크 계층단은 아니지만, 프론트엔드 서비스 앞단 CDN에서 캐시 되는걸로 고민을 많이 했다.! 다른 분들은 어떨지 궁금,,

원격 프로시저 호출 (RPC)

다른 계층간 RPC는 호출자가 응답 기다리는 동기 방식이거나 호출자는 계속 실행하고 여러 서버에서 병렬로 RPC를 처리하는 비동기적 방식

여기서 계층이란 네트워크 7계층을 의미하는 듯, 아래는 원격 함수 호출을 통해 데이터를 주고받을 수 있는 에시

- 프레젠테이션 계층에서 애플리케이션 계층으로: 사용자가 버튼을 클릭하면, 클라이언트는 서버의 비즈니스 로직 함수를 호출
- 애플리케이션 계층에서 데이터 접근 계층으로: 비즈니스 로직 함수가 데이터베이스에서 데이터를 읽거나 쓸 필요가 있을 때, 데이터 접근 계층의 함수를 호출
- 애플리케이션 계층에서 외부 서비스로: 서버가 외부 API와 통신해야 할 때, 외부 서비스의 API를 호출

> RPC란 다른 계층 간에 함수나 프로시저를 실행할 수 있게 하는 프로세스 간 통신 기술 클라이언트와 서버가 네트워크를 통해 서로 통신할 수 있게 한다.
- 장점 : 고유 프로세스 개발에 집중 가능 (하부 네트워크 프로토콜에 신경쓰지 않아도 되기 때문)
- 단점 : 호출 실행과 반환 시간이 보장되지 않음 (네트워크 구간을 통하여 RPC 통신을 하는 경우, 네트워크가 끊겼을 때 치명적 문제 발생)

> 일반적으로 프로세스(Process)는 자신의 주소공간 안에 존재하는 함수만 호출하여 실행 가능하다. 그러나, RPC의 경우 자신과 다른 주소공간에서 동작하는 프로세스의 함수를 실행할 수 있게 해주는 프로토콜 마치 로컬 함수 호출처럼 보이지만, 실제로는 네트워크를 통해 호출 통해 이루어진다.

> gRPC는 구글이 개발한 오픈소스 RPC 시스템 gRPC는 HTTP/2와 프로토콜 버퍼 (Protocol Buffers)를 사용하여 높은 성능과 효율성을 제공
>> HTTP/2 기반: HTTP/2를 사용하여 멀티플렉싱, 헤더 압축, 스트리밍과 같은 기능을 제공

>> gRPC 강의 사놓은 거 얼른 들어야지 ;;

### 1.4 긴 꼬리 지연시간

중앙값이나 평균과 유사한 지연시간은 실제값과는 대부분 비슷하지 않고 긴 꼬리 시간의 모양과 크기에 대해 알려주지 못한다. -> 백분위 수 사용


### 1.5 프레임워크에 대한 고찰

프레임워크는 테스트할 소프트웨어와 하드웨어 시스템, 시스템에 제공하는 부하, 성능에 대한 사람의 기댓값, 실제 역동성과 성능을 관찰하는 소프트웨어 성능 측정 도구, 일어난 결과에 대한 이유과 결과적으로 성능이 향상되도록 수정하거나 변경한 것
-> 애플리케이션 개발을 위한 구조를 제공하는 미리 작성된 코드 라이브러리 집합과는 다른 개념인가?

### 1.6 크기 정도 산정

기댓값의 크기를 에측하는 습관을 기르자! 다양한 작업에서 소요되는 목표 시간 산정,, 어렵다

### 1.7 트랜잭션이 느린 이유

일반적으로는 낮은 계층에서의 응답을 기다리면서 발생

트랜잭션 방해 : 한 서버에서 RPC의 정상 동작을 방해해 이를 느리게하는 무언가,, 

느린 코드 계층 파악하고, 이를 방해하는 요소 무엇인지 찾아낸다음, 수정하면 된다
> 말은 쉽지만,, ㅠㅠ

### 1.8 5가지 기본적인 지원들

- CPU
- 메모리
- 디스크 / SSD
- 네트워크
- 소프트웨어 임계 구역
